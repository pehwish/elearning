<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>e learning text contents</title>
    <link rel="stylesheet" href="/elearning/css/style.min.css" />
  </head>
  <body>
    <div id="app">
      <div class="quiz">가장 큰 수는?</div>
      <div class="hero">
        <img src="/elearning/images/santa/Walk_1.png" id="heroImg" alt="" />
      </div>
      <div class="tiles"></div>
      <div class="boxs">
        <div class="boxs__inner">
          <button class="box" data-number="12">
            <span class="box__text">12</span>
          </button>
          <button class="box" data-number="22">
            <span class="box__text">22</span>
          </button>
          <button class="box" data-number="33">
            <span class="box__text">33</span>
          </button>
        </div>
      </div>
    </div>
    <script src="/elearning/js/anime.min.js"></script>
    <script>
      function animate(opts) {
        var start = new Date(),
          id = setInterval(function () {
            var timePassed = new Date() - start,
              progress = timePassed / opts.duration;

            if (progress > 1) progress = 1;

            var delta = opts.delta(progress);
            opts.step(delta);

            if (progress === 1) {
              clearInterval(id);
            }
          }, opts.delay);
      }

      function makeEaseOut(delta) {
        return function (progress) {
          return 1 - delta(1 - progress);
        };
      }

      function linear(progress) {
        return progress;
      }

      function spriteAnimation(spriteArray, spriteObj, duration = 1300) {
        var index = 0;
        animate({
          delay: 50,
          duration,
          delta: makeEaseOut(linear),
          step: function (delta) {
            console.log('@ sprite!');
            if (spriteArray.length - 1 === index) {
              index = 0;
            }
            spriteObj.src = spriteArray[index];
            index++;
          }
        });
      }

      const hero = document.getElementById('heroImg');

      const animationFrame = {
        working: [
          '/elearning/images/santa/Walk_1.png',
          '/elearning/images/santa/Walk_2.png',
          '/elearning/images/santa/Walk_3.png',
          '/elearning/images/santa/Walk_4.png',
          '/elearning/images/santa/Walk_5.png',
          '/elearning/images/santa/Walk_6.png',
          '/elearning/images/santa/Walk_7.png',
          '/elearning/images/santa/Walk_8.png',
          '/elearning/images/santa/Walk_9.png',
          '/elearning/images/santa/Walk_10.png',
          '/elearning/images/santa/Walk_11.png',
          '/elearning/images/santa/Walk_12.png',
          '/elearning/images/santa/Walk_13.png'
        ],
        idles: [
          '/elearning/images/santa/Idle_1.png',
          '/elearning/images/santa/Idle_2.png',
          '/elearning/images/santa/Idle_3.png',
          '/elearning/images/santa/Idle_4.png',
          '/elearning/images/santa/Idle_5.png',
          '/elearning/images/santa/Idle_6.png',
          '/elearning/images/santa/Idle_7.png',
          '/elearning/images/santa/Idle_8.png',
          '/elearning/images/santa/Idle_9.png',
          '/elearning/images/santa/Idle_10.png',
          '/elearning/images/santa/Idle_11.png',
          '/elearning/images/santa/Idle_12.png',
          '/elearning/images/santa/Idle_13.png',
          '/elearning/images/santa/Idle_14.png',
          '/elearning/images/santa/Idle_15.png',
          '/elearning/images/santa/Idle_16.png'
        ],
        jumps: [
          '/elearning/images/santa/Jump_1.png',
          '/elearning/images/santa/Jump_2.png',
          '/elearning/images/santa/Jump_3.png',
          '/elearning/images/santa/Jump_4.png',
          '/elearning/images/santa/Jump_5.png',
          '/elearning/images/santa/Jump_6.png',
          '/elearning/images/santa/Jump_7.png',
          '/elearning/images/santa/Jump_8.png',
          '/elearning/images/santa/Jump_9.png',
          '/elearning/images/santa/Jump_10.png',
          '/elearning/images/santa/Jump_11.png',
          '/elearning/images/santa/Jump_12.png',
          '/elearning/images/santa/Jump_13.png',
          '/elearning/images/santa/Jump_14.png',
          '/elearning/images/santa/Jump_15.png',
          '/elearning/images/santa/Jump_16.png'
        ],
        dead: [
          '/elearning/images/santa/Dead_1.png',
          '/elearning/images/santa/Dead_2.png',
          '/elearning/images/santa/Dead_3.png',
          '/elearning/images/santa/Dead_4.png',
          '/elearning/images/santa/Dead_5.png',
          '/elearning/images/santa/Dead_6.png',
          '/elearning/images/santa/Dead_7.png',
          '/elearning/images/santa/Dead_8.png',
          '/elearning/images/santa/Dead_9.png',
          '/elearning/images/santa/Dead_10.png',
          '/elearning/images/santa/Dead_11.png',
          '/elearning/images/santa/Dead_12.png',
          '/elearning/images/santa/Dead_13.png',
          '/elearning/images/santa/Dead_14.png',
          '/elearning/images/santa/Dead_15.png',
          '/elearning/images/santa/Dead_16.png',
          '/elearning/images/santa/Dead_17.png'
        ]
      };

      var tID;
      function animateScript(spriteArray, spriteObj) {
        var index = 0;

        var position = 256; //start position for the image slicer
        const interval = 100; //100 ms of interval for the setInterval()
        tID = setInterval(() => {
          if (spriteArray.length - 1 === index) {
            index = 0;
          }
          spriteObj.src = spriteArray[index];
          index++;
        }, interval);
      }

      function stopAnimate() {
        clearInterval(tID);
      } //end of stopAnimate()

      function idle() {
        animateScript(animationFrame.idles, hero);
      }

      const boxs = document.querySelectorAll('.box');

      const ANSWER = 2;

      let answerPosition = [
        {
          x: '-40vw',
          y: '40vh'
        },
        {
          x: '-40vw',
          y: '10vh'
        },
        {
          x: '-50vw',
          y: '-8vh'
        }
      ];

      boxs.forEach((box, index) => {
        box.addEventListener('click', () => {
          console.log('click', box.dataset.number);
          stopAnimate();
          anime({
            targets: box,
            translateX: answerPosition[index].x,
            translateY: answerPosition[index].y,
            duration: 1300,
            complete: setTimeout(() => resultHero(index), 600)
          });
        });
      });

      function resultHero(selectAnswer) {
        stopAnimate();
        anime.remove('.hero');
        anime.remove('.box');

        animateScript(animationFrame.jumps, hero);
        anime({
          targets: '.hero',
          translateX: '+=34vw',
          translateY: '-=4vh',
          duration: 1300,
          easing: 'easeInOutSine',
          complete: setTimeout(() => resultMotion(), 1000)
        });

        const resultMotion = () => {
          stopAnimate();
          if (selectAnswer === ANSWER) {
            console.log('정답!!!~!');
            anime.remove('.hero');
            animateScript(animationFrame.idles, hero);
          } else {
            console.log('오답!!!');
            anime.remove('.hero');
            animateScript(animationFrame.dead, hero);
          }
        };
      }

      //이미지 프리로드
      const preLoadImg = images => {
        images.forEach(image => {
          const img = new Image();
          img.src = image;
        });
      };

      async function init() {
        await preLoadImg([
          ...animationFrame.working,
          ...animationFrame.idles,
          ...animationFrame.jumps,
          ...animationFrame.dead
        ]);

        spriteAnimation(animationFrame.working, hero, 1300);

        anime({
          targets: '.hero',
          translateX: 70,
          duration: 1300,
          easing: 'linear',
          complete: idle
        });
      }

      init();
    </script>
  </body>
</html>
